<?xml version="1.0" encoding="iso-8859-1"?>

<project
  default="jcaptcha:all"
  xmlns:j="jelly:core"
  xmlns:maven="jelly:maven"
  xmlns:artifact="artifact"
  xmlns:ant="jelly:ant">

  <goal name="jcaptcha:all" description="build and package a jcaptcha distribution, builds the jcaptcha-maven site">
        <attainGoal name="jcaptcha:deploy-jhlab"/>
        <attainGoal name="jcaptcha:jars"/>
<!--        <attainGoal name="clean"/>-->
<!--        <attainGoal name="multiproject:clean"/>-->
        <attainGoal name="jcaptcha:dist"/>
  </goal>

     <goal name="jcaptcha:jars" description="build and install jcaptcha jars">
    <maven:reactor
        basedir="${basedir}"
        includes="*/project.xml"
        excludes="project.xml"
        goals="jar:install"
        banner="jars"
        ignoreFailures="false"/>
       </goal>

  <goal name="jcaptcha:dist" description="build and package a jcaptcha distribution">
    <maven:reactor
        basedir="${basedir}"
        includes="*/project.xml"
        excludes="project.xml"
        goals="dist"
        banner="distribution"
        ignoreFailures="false"/>

    <ant:zip zipfile="${maven.build.dir}/${pom.artifactId}-${pom.currentVersion}-src.zip"
    	basedir=".">
    	<ant:fileset dir="${basedir}">
    		<exclude name="**/target/**"/>
    	</ant:fileset>
    	</ant:zip>

    <ant:mkdir dir="${maven.build.dir}/distributions"/>

    <ant:copy todir="${maven.build.dir}/distributions">
    	<ant:fileset dir="${basedir}">
    		<include name="**/*.jar"/>
    	</ant:fileset>
    </ant:copy>



       <!--
    <maven:reactor
        basedir="${basedir}"
        includes="**/${pattern}/**/project.xml"
        excludes="project.xml"
        goals="dist"
        banner="distribution"
        ignoreFailures="false"/>
    <ant:mkdir dir="${maven.build.dir}/distributions"/>
    <ant:mkdir dir="${maven.build.dir}/src-distributions"/>
    <ant:unzip dest="${maven.build.dir}/distributions">
    	<ant:fileset dir="${basedir}" includes="**/target/distributions/*.zip" excludes="*src.zip"/>
    </ant:unzip>


    <ant:unzip dest="${maven.build.dir}/src-distributions">
    	<ant:fileset dir="${basedir}" includes="**/target/distributions/*src.zip"/>
    </ant:unzip>

    <ant:copy todir="${maven.build.dir}/distributions">
    	<ant:fileset dir="${basedir}">
    		<include name="LICENSE.txt"/>
    	</ant:fileset>
    </ant:copy>

    <ant:copy todir="${maven.build.dir}/distributions">
    	<ant:fileset dir="${basedir}">
    		<include name="**/doc/**"/>
    	</ant:fileset>
    </ant:copy>

    <ant:copy todir="${maven.build.dir}/src-distributions">
    	<ant:fileset dir="${basedir}">
    		<include name="lib/**"/>
    		<include name="images/**"/>
    		<include name="xdocs/**"/>
    		<include name="*.xml"/>
    		<include name="*.txt"/>
    		<include name="*.properties"/>
    	</ant:fileset>
    </ant:copy>

    <ant:zip zipfile="${maven.build.dir}/${pom.artifactId}-${pom.currentVersion}.zip"
    	basedir="${maven.build.dir}/distributions"/>
    <ant:zip zipfile="${maven.build.dir}/${pom.artifactId}-${pom.currentVersion}-src.zip"
    	basedir="${maven.build.dir}/src-distributions"/>
    	-->

  </goal>

     <goal name="jcaptcha:dist" description="build and package a jcaptcha distribution">
    <maven:reactor
        basedir="${basedir}"
        includes="*/project.xml"
        excludes="project.xml"
        goals="dist"
        banner="distribution"
        ignoreFailures="false"/>

   <ant:zip zipfile="${maven.build.dir}/${pom.artifactId}-${pom.currentVersion}-src.zip"
    	basedir=".">
    	<ant:fileset dir="${basedir}">
    		<exclude name="**/target/**"/>
    	</ant:fileset>
    	</ant:zip>

    <ant:mkdir dir="${maven.build.dir}/distributions"/>

    <ant:copy todir="${maven.build.dir}/distributions">
    	<ant:fileset dir="${basedir}">
    		<include name="**/*.jar"/>
    	</ant:fileset>
    </ant:copy>



       <!--
    <maven:reactor
        basedir="${basedir}"
        includes="**/${pattern}/**/project.xml"
        excludes="project.xml"
        goals="dist"
        banner="distribution"
        ignoreFailures="false"/>
    <ant:mkdir dir="${maven.build.dir}/distributions"/>
    <ant:mkdir dir="${maven.build.dir}/src-distributions"/>
    <ant:unzip dest="${maven.build.dir}/distributions">
    	<ant:fileset dir="${basedir}" includes="**/target/distributions/*.zip" excludes="*src.zip"/>
    </ant:unzip>


    <ant:unzip dest="${maven.build.dir}/src-distributions">
    	<ant:fileset dir="${basedir}" includes="**/target/distributions/*src.zip"/>
    </ant:unzip>

    <ant:copy todir="${maven.build.dir}/distributions">
    	<ant:fileset dir="${basedir}">
    		<include name="LICENSE.txt"/>
    	</ant:fileset>
    </ant:copy>

    <ant:copy todir="${maven.build.dir}/distributions">
    	<ant:fileset dir="${basedir}">
    		<include name="**/doc/**"/>
    	</ant:fileset>
    </ant:copy>

    <ant:copy todir="${maven.build.dir}/src-distributions">
    	<ant:fileset dir="${basedir}">
    		<include name="lib/**"/>
    		<include name="images/**"/>
    		<include name="xdocs/**"/>
    		<include name="*.xml"/>
    		<include name="*.txt"/>
    		<include name="*.properties"/>
    	</ant:fileset>
    </ant:copy>

    <ant:zip zipfile="${maven.build.dir}/${pom.artifactId}-${pom.currentVersion}.zip"
    	basedir="${maven.build.dir}/distributions"/>
    <ant:zip zipfile="${maven.build.dir}/${pom.artifactId}-${pom.currentVersion}-src.zip"
    	basedir="${maven.build.dir}/src-distributions"/>
    	-->

  </goal>

  <goal name="jcaptcha:deploy-jhlab" description="copy jhlabs librairy to your maven local repository">
    <ant:mkdir dir="${maven.repo.local}/jhlabs/jars"/>
    <ant:copy file="${basedir}/lib/imaging-1.0.jar" todir="${maven.repo.local}/jhlabs/jars"/>
  </goal>


</project>