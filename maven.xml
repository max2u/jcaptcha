<?xml version="1.0" encoding="iso-8859-1"?>

<project
  default="assemble"
  xmlns:j="jelly:core"
  xmlns:maven="jelly:maven"
  xmlns:artifact="artifact"
  xmlns:ant="jelly:ant">

  <preGoal name="multiproject:site">
    <ant:copy file="${basedir}/images/organization-logo.jpg" todir="${maven.build.dir}/docs/images"/>
    <ant:copy file="${basedir}/images/project-logo.jpg" todir="${maven.build.dir}/docs/images"/>
  </preGoal>

  <preGoal name="assemble">
    <ant:mkdir dir="${maven.repo.local}/jhlabs/jars"/>
    <ant:copy file="${basedir}/lib/imaging-1.0.jar" todir="${maven.repo.local}/jhlabs/jars"/>
  </preGoal>

  <goal name="assemble">
    <maven:reactor
        basedir="${basedir}"
        includes="**/${pattern}/**/project.xml"
        excludes="project.xml"
        goals="assemble"
        banner="Building"
        ignoreFailures="false"/>
  </goal>

  <goal name="build">
    <maven:reactor 
        basedir="${basedir}"
        includes="**/${pattern}/**/project.xml"
        excludes="project.xml"
        goals="dist"
        banner="distribution"
        ignoreFailures="false"/>
    <ant:mkdir dir="${maven.build.dir}/distributions"/>
    <ant:mkdir dir="${maven.build.dir}/src-distributions"/>
    <ant:unzip dest="${maven.build.dir}/distributions">
    	<ant:fileset dir="${basedir}" includes="**/target/distributions/*.zip" excludes="*src.zip"/>
    </ant:unzip>
   
   
    <ant:unzip dest="${maven.build.dir}/src-distributions">
    	<ant:fileset dir="${basedir}" includes="**/target/distributions/*src.zip"/>
    </ant:unzip>
    
    <ant:copy todir="${maven.build.dir}/distributions">
    	<ant:fileset dir="${basedir}">
    		<include name="LICENSE.txt"/>
    	</ant:fileset>
    </ant:copy>
    
    <ant:copy todir="${maven.build.dir}/distributions">
    	<ant:fileset dir="${basedir}">
    		<include name="**/doc/**"/>
    	</ant:fileset>
    </ant:copy>
    
    <ant:copy todir="${maven.build.dir}/src-distributions">
    	<ant:fileset dir="${basedir}">
    		<include name="lib/**"/>
    		<include name="images/**"/>
    		<include name="xdocs/**"/>
    		<include name="*.xml"/>
    		<include name="*.txt"/>
    		<include name="*.properties"/>
    	</ant:fileset>
    </ant:copy>
    
    <ant:zip zipfile="${maven.build.dir}/${pom.artifactId}-${pom.currentVersion}.zip"
    	basedir="${maven.build.dir}/distributions"/>
    <ant:zip zipfile="${maven.build.dir}/${pom.artifactId}-${pom.currentVersion}-src.zip"
    	basedir="${maven.build.dir}/src-distributions"/>
  </goal>
  
  <preGoal name="clean">
    <maven:reactor 
        basedir="${basedir}"
        includes="**/${pattern}/**/project.xml"
        excludes="project.xml"
        goals="clean"
        banner="cleanning"
        ignoreFailures="false"/>
  </preGoal>
</project>